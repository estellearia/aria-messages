<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Signal Fragment - Aria</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      background: black;
      color: white;
      font-family: 'Press Start 2P', monospace;
      overflow-x: hidden;
      height: 100vh;
      margin: 0;
      padding: 0;
    }
    .main-center {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    .blinking {
      animation: blink 1s step-start infinite;
      color: #00ffcc;
      margin-bottom: 8px;
      cursor: pointer;
      font-size: 18px;
      padding: 22px 38px;
      border: 3px dashed #6ee7b7;
      border-radius: 10px;
      background: #161b1b;
      box-shadow: 0 0 8px #6ee7b7;
      transition: background 0.2s;
      z-index: 2;
      position: relative;
    }
    .blinking:hover {
      background: #222;
    }
    @keyframes blink {
      50% { opacity: 0; }
    }
    /* Fragment Opening Animation */
    .fragment-opening {
      width: 68px;
      height: 68px;
      background: #1a1a1a;
      border: 3px dashed #5fffd0;
      border-radius: 50%;
      margin: 0 auto;
      position: relative;
      box-shadow: 0 0 18px #5fffd0, 0 0 0 #fff;
      z-index: 10;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: visible;
      animation: fragment-pulse 1.4s cubic-bezier(.42,0,.58,1) forwards;
    }
    .fragment-circle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #5fffd0;
      filter: blur(4px);
      opacity: 0.4;
      animation: fragment-glow 1.1s cubic-bezier(.42,0,.58,1) infinite alternate;
    }
    .fragment-crack {
      position: absolute;
      width: 34px;
      height: 5px;
      left: 17px;
      top: 31px;
      background: linear-gradient(90deg, #fff 0%, #5fffd0 100%);
      border-radius: 2px;
      transform: rotate(-15deg);
      opacity: 0.8;
      animation: fragment-crack-appear 1.1s cubic-bezier(.42,0,.58,1) forwards;
      animation-delay: 0.4s;
      pointer-events: none;
    }
    @keyframes fragment-pulse {
      0%   { transform: scale(0.85); box-shadow: 0 0 0 #5fffd0, 0 0 0 #fff; }
      50%  { transform: scale(1.08); box-shadow: 0 0 30px #5fffd0, 0 0 12px #fff; }
      100% { transform: scale(1.12); box-shadow: 0 0 48px #5fffd0, 0 0 0 #fff; }
    }
    @keyframes fragment-glow {
      from { opacity: 0.4; }
      to   { opacity: 0.7; }
    }
    @keyframes fragment-crack-appear {
      0%   { opacity: 0; width: 0; }
      80%  { opacity: 1; width: 34px;}
      100% { opacity: 1; width: 34px;}
    }
    /* After animation, fade out the fragment opening */
    .fragment-opening.hide {
      animation: fragment-fadeout 0.5s cubic-bezier(.42,0,.58,1) forwards;
    }
    @keyframes fragment-fadeout {
      to { opacity: 0; transform: scale(1.6); }
    }
    /* --- SIGNAL FRAGMENT BOX --- */
    .signal-fragment {
      width: 360px;
      min-height: 248px;
      max-width: 600px;
      padding: 32px 24px 24px 24px;
      background: repeating-linear-gradient(
          -45deg,
          #1a1a1a,
          #1a1a1a 10px,
          #222 10px,
          #222 20px
      );
      border: 3px dashed #6ee7b7;
      color: #c0fff3;
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      line-height: 1.8;
      white-space: pre-wrap;
      box-shadow: 0 0 8px #6ee7b7;
      border-radius: 12px;
      position: relative;
      overflow: visible;
      animation: fragment-box-in 0.7s cubic-bezier(.42,0,.58,1) forwards;
      display: none;
      z-index: 1;
      text-align: left;
      transition: min-height 0.4s cubic-bezier(.77,0,.18,1), width 0.4s cubic-bezier(.77,0,.18,1);
      opacity: 0;
    }
    .signal-fragment.visible {
      display: block;
      opacity: 1;
      animation: fragment-box-in 0.7s cubic-bezier(.42,0,.58,1) forwards;
    }
    .signal-fragment.expanded {
      min-height: 320px;
      width: 95vw;
      max-width: 600px;
    }
    @keyframes fragment-box-in {
      from { opacity: 0; transform: scale(0.96) translateY(22px);}
      to   { opacity: 1; transform: scale(1) translateY(0);}
    }
    .avatar {
      display: block;
      margin: 0 auto 16px auto;
      width: 64px;
      height: 64px;
      image-rendering: pixelated;
      border: 2px solid #6ee7b7;
      border-radius: 8px;
      background: black;
      padding: 2px;
      box-shadow: 0 0 6px #6ee7b7;
    }
    .signal-fragment p {
      margin: 14px 0;
      animation: flicker 0.15s infinite alternate;
    }
    @keyframes flicker {
      0% { opacity: 1; }
      100% { opacity: 0.96; }
    }
    @keyframes glitch-border {
      0%, 100% { box-shadow: 0 0 8px #6ee7b7; }
      20% { box-shadow: -2px 0 6px #6ee7b7; }
      40% { box-shadow: 2px 2px 12px #6ee7b7; }
      60% { box-shadow: 0 -2px 8px #6ee7b7; }
      80% { box-shadow: 1px 1px 10px #6ee7b7; }
    }
    /* ---- STEADY (final message, improved) ---- */
    .signal-steady {
      display: none;
      border-radius: 18px;
      padding: 42px 28px 30px 28px;
      min-width: 0;
      max-width: 340px;
      margin: 58px auto 0 auto;
      text-align: center;
      position: relative;
      background: rgba(16, 32, 28, 0.66);
      box-shadow:
        0 2px 24px #23cfa099,
        0 0 0 2px #23cfa066 inset,
        0 1.5px 24px 0 #5fffd044;
      border: 2.5px solid #5fffd0;
      animation: steady-glow 2.4s infinite alternate;
      backdrop-filter: blur(7px);
      z-index: 2;
      transition: box-shadow 0.3s, background 0.4s;
      overflow: visible;
      letter-spacing: 0.05em;
      font-family: 'Press Start 2P', monospace;
    }
    .steady-icon {
      margin-bottom: 12px;
      animation: pop-in 0.7s cubic-bezier(.42,0,.58,1);
    }
    @keyframes pop-in {
      from { opacity: 0; transform: scale(0.7);}
      to   { opacity: 1; transform: scale(1);}
    }
    .steady-message {
      margin-bottom: 14px;
    }
    .steady-title {
      color: #5fffd0;
      font-size: 1.13em;
      font-weight: bold;
      margin-bottom: 4px;
      text-shadow: 0 1px 8px #39ffe033, 0 0 1px #23cfa0;
      letter-spacing: 0.13em;
    }
    .steady-desc {
      color: #eefefa;
      font-size: 1em;
      margin-bottom: 0;
      opacity: 0.92;
      line-height: 1.9;
    }
    .steady-divider {
      border: none;
      border-top: 1.7px dashed #39ffe0;
      margin: 18px 0 16px 0;
      opacity: 0.4;
    }
    .next-btn {
      display: inline-block;
      padding: 13px 32px 13px 26px;
      border-radius: 13px;
      background: linear-gradient(90deg, #192221 0%, #243331 100%);
      color: #39ffe0;
      border: 2.5px solid #5fffd0;
      box-shadow: 0 2px 12px #23cfa077, 0 0 0 1.5px #39ffe055 inset;
      font-family: 'Press Start 2P', monospace;
      font-size: 13px;
      cursor: pointer;
      text-decoration: none;
      margin: 0 auto;
      position: relative;
      transition: border-color 0.19s, box-shadow 0.19s, background 0.19s, color 0.16s, transform 0.09s;
      outline: none;
      z-index: 2;
      filter: brightness(1.13);
      letter-spacing: 0.08em;
    }
    .next-btn:active {
      transform: translateY(2px) scale(0.98);
      box-shadow: 0 0.5px 2px #23cfa055;
      background: linear-gradient(90deg, #111917 0%, #1a2422 100%);
    }
    .next-btn:hover,
    .next-btn:focus {
      background: linear-gradient(90deg, #111917 0%, #242f2e 100%);
      color: #b6fff0;
      border-color: #23cfa0;
      box-shadow: 0 4px 16px #5fffd0, 0 0 0 2px #23cfa088 inset;
      filter: brightness(1.18);
    }
    @media (max-width: 520px) {
      .signal-steady {
        max-width: 99vw;
        padding: 14vw 2vw 10vw 2vw;
      }
      .steady-title { font-size: 1em; }
      .next-btn { font-size: 12px; padding: 10px 18px 10px 16px; }
    }
    @keyframes steady-glow {
      0% {
        box-shadow:
          0 2px 24px #23cfa077,
          0 0 0 2px #5fffd066 inset,
          0 1.5px 24px 0 #5fffd044;
        border-color: #5fffd0;
      }
      50% {
        box-shadow:
          0 0px 36px #5fffd0cc,
          0 0 0 2.5px #23cfa099 inset,
          0 2.5px 38px 4px #23cfa044;
        border-color: #23cfa0;
      }
      100% {
        box-shadow:
          0 2px 24px #23cfa077,
          0 0 0 2px #5fffd066 inset,
          0 1.5px 24px 0 #5fffd044;
        border-color: #5fffd0;
      }
    }
    .signal-steady::before {
      content: "";
      pointer-events: none;
      position: absolute;
      inset: 0;
      border-radius: 18px;
      background: linear-gradient(120deg, #5fffd033 20%, #23cfa022 90%);
      z-index: 1;
      box-shadow: 0 0 40px 8px #5fffd055;
      opacity: 0.55;
      filter: blur(2px);
    }
  </style>
</head>
<body>
  <div class="main-center">
    <!-- Initial Prompt -->
    <div id="fragmentPrompt" class="blinking" tabindex="0">
      [DATA FRAGMENT FOUND]<br>
      <span style="font-size:10px; color:#6ee7b7;">Click to initialize</span>
    </div>

    <audio id="bgStatic" preload="auto" style="display:none">
      <source src="https://github.com/estellearia/type-sound/raw/refs/heads/main/60820__erh__radio-t2-lw-static.wav" type="audio/wav">
      Your browser does not support the audio element.
    </audio>

    <!-- Fragment Opening Animation -->
    <div class="fragment-opening" id="fragmentOpening" style="display:none;">
      <div class="fragment-circle"></div>
      <div class="fragment-crack"></div>
    </div>

    <!-- Container 1: Signal Fragment -->
    <div class="signal-fragment" id="signalContainer">
      <img class="avatar" src="https://i.imgur.com/9OC7GRw.gif" alt="Aria Avatar">
      <div id="typedLetter"></div>
    </div>

    <!-- Container 2: Signal Steady (improved UI) -->
    <div class="signal-steady" id="steadyContainer">
      <div class="steady-icon">
        <svg viewBox="0 0 36 36" width="38" height="38" fill="none">
          <circle cx="18" cy="18" r="16" stroke="#5fffd0" stroke-width="3" fill="#192221" opacity="0.4"/>
          <polyline points="11,19 16,25 25,13" stroke="#39ffe0" stroke-width="3.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="steady-message">
        <div class="steady-title">Signal Stable</div>
        <div class="steady-desc">Ready for next fragment?</div>
      </div>
      <hr class="steady-divider" />
      <div class="btn-row">
        <a href="#" class="next-btn" id="continueBtn">
          Continue <span style="font-size:1.25em;vertical-align:-2px;">&gt;</span>
        </a>
      </div>
    </div>
  </div>

  <div id="turbulence1"></div>

  <script>
    function showFragmentOpening(cb) {
      const opening = document.getElementById("fragmentOpening");
      opening.style.display = "flex";
      opening.classList.remove("hide");
      // Hide after animation
      setTimeout(() => {
        opening.classList.add("hide");
        setTimeout(() => {
          opening.style.display = "none";
          if (cb) cb();
        }, 500); // matches fadeout duration
      }, 1300); // total time before starting fadeout
    }

    function startSignalSequence() {
      document.getElementById("fragmentPrompt").style.display = "none";
      showFragmentOpening(() => {
        const sigContainer = document.getElementById("signalContainer");
        sigContainer.style.display = "block";
        setTimeout(() => {
          sigContainer.classList.add('visible');
        }, 20); // allow display:block before animating in

        sigContainer.classList.remove('expanded'); // start with static min height

        const bgAudio = document.getElementById("bgStatic");
        bgAudio.volume = 0.2;
        bgAudio.currentTime = 0;
        bgAudio.play();
        const loopEnd = 2.0;
        bgAudio.addEventListener('timeupdate', function loopStatic() {
          if (bgAudio.currentTime >= loopEnd) {
            bgAudio.currentTime = 0;
            bgAudio.play();
          }
        });

        setTimeout(() => {
          const paragraphs = [
            "* 1/5 fragment recovered... 📡",
            "Hehehe, hi there baby!",
            "It’s wild how we’re on opposite sides of the world, yet we always find ways to make time for each other ><",
            "I don’t really mind the long 2 AMs as long as I get to sync into your world, to see you, hear you, and share our days, no matter how far apart we are!!",
            "I'd like to think na maybe that’s what makes us special? Na even when the world feels out of sync, we keep tuning in to each other, again and agaaaain.",
            "You’re my favorite frequency, looove. Thank you for showing me that this kind of love exists.",
            "I love you, always."
          ];

          const container = document.getElementById("typedLetter");
          let paraIndex = 0;

          function typeParagraph(text, callback) {
            const p = document.createElement("p");
            container.appendChild(p);
            let charIndex = 0;

            function typeChar() {
              if (charIndex < text.length) {
                const char = text.charAt(charIndex);
                p.innerHTML += (char === "\n") ? "<br>" : char;
                charIndex++;
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                setTimeout(typeChar, 45 + Math.random() * 40);
              } else {
                // if content is overflowing, expand the container
                if (sigContainer.scrollHeight > sigContainer.clientHeight) {
                  sigContainer.classList.add('expanded');
                }
                callback();
              }
            }

            typeChar();
          }

          function typeAllParagraphs() {
            if (paraIndex < paragraphs.length) {
              typeParagraph(paragraphs[paraIndex], () => {
                paraIndex++;
                setTimeout(typeAllParagraphs, 600);
              });
            } else {
              setTimeout(() => {
                sigContainer.style.display = "none";
                document.getElementById("steadyContainer").style.display = "block";
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
              }, 800);
            }
          }

          typeAllParagraphs();
        }, 500);
      });
    }

    function handleFragmentPrompt(event) {
      if (
        event.type === "click" ||
        (event.type === "keydown" && (event.key === "Enter" || event.key === " "))
      ) {
        startSignalSequence();
      }
    }
    const fragmentPrompt = document.getElementById("fragmentPrompt");
    fragmentPrompt.addEventListener("click", handleFragmentPrompt);
    fragmentPrompt.addEventListener("keydown", handleFragmentPrompt);

    // Stop audio and redirect on continue
    document.getElementById("continueBtn").addEventListener("click", function(e) {
      e.preventDefault();
      var bgAudio = document.getElementById("bgStatic");
      if (bgAudio) {
        bgAudio.pause();
        bgAudio.currentTime = 0;
      }
      window.top.location.href = "https://estellearia.github.io/aria-messages/turbulence.html";
    });
  </script>
</body>
</html>
